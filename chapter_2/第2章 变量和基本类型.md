# 第2章 变量和基本类型

## 2.1 基本内置类型
### 2.1.1 算术类型
| 类型          | 含义        | 最小尺寸    |
|-------------|-----------|---------|
| bool        | 布尔类型      | 未定义     |
| char        | 字符        | 8位      |
| wchar_t     | 宽字符       | 16位     |
| char16_t    | Unicode字符 | 16位     |
| char32_t    | Unicode字符 | 32位     |
| short       | 短整型       | 16位     |
| int         | 整型        | 16位     |
| long        | 长整型       | 32位     |
| long long   | 长整型       | 64位     |
| float       | 单精度浮点数    | 6位有效数字  |
| double      | 双精度浮点数    | 10位有效数字 |
| long double | 扩展精度浮点数   | 10位有效数字 |
C++语言规定，一个`int`至少和一个`short`一样大，一个`long`至少和一个`int`一样大，一个`long long`至少和一个`long`一样大。

类型`int`、`short`、`long`和`long long`都是带符号的，在这些类型名前添加`unsigned`就可以得到无符号类型。

字符型被分为了3种：`char`、`signed char`和`unsigned char`。类型`char`和类型`signed char`并不一样，具体表现为`signed char`还是`unsigned char`取决于编译器。
### 2.1.2 类型转换
### 2.1.3 字面值常量
我们可以以0开头的整数代表八进制数，以0x开头的整数代表十六进制数，以0b开头的整数代表二进制数。

| 转义字符 | 含义    |
|------|-------|
| \n   | 换行符   |
| \v   | 纵向制表符 |
| \t   | 横向制表符 |
| \\   | 反斜线   |
| \r   | 回车符   |
| \b   | 退格符   |
| \?   | 问号    |
| \f   | 进纸符   |
| \a   | 报警    |
| \"   | 双引号   |
| \'   | 单引号   |

<table>
    <tr>
        <th colspan="3">字符和字符串字面值</th>
    </tr>
    <tr>
        <td>前缀</td>
        <td>含义</td>
        <td>类型</td>
    </tr>
    <tr>
        <td>u</td>
        <td>Unicode 16字符</td>
        <td>char16_t</td>
    </tr>
    <tr>
        <td>U</td>
        <td>Unicode 32字符</td>
        <td>char32_t</td>
    </tr>
    <tr>
        <td>L</td>
        <td>宽字符</td>
        <td>wchar_t</td>
    </tr>
    <tr>
        <td>u8</td>
        <td>UTF-8(仅用于字符串字面常量)</td>
        <td>char</td>
    </tr>
</table>

<table>
    <tr>
        <th colspan="2">整型字面值</th>
        <th colspan="2">浮点型字面值</th>
    </tr>
    <tr>
        <td>后缀</td>
        <td>最小匹配类型</td>
        <td>后缀</td>
        <td>类型</td>
    </tr>
    <tr>
        <td>u / U</td>
        <td>unsigned</td>
        <td>f / F</td>
        <td>float</td>
    </tr>
    <tr>
        <td>l / L</td>
        <td>long</td>
        <td>l / L</td>
        <td>long double</td>
    </tr>
    <tr>
        <td>ll / LL</td>
        <td>long long</td>
    </tr>
</table>

## 2.2 变量
### 2.2.1 变量定义
初始化不是赋值。**初始化**是指创建一个变量并就赋予它一个初始值。而**赋值**是指把变量的当前值擦除，并用一个新值覆盖它。

未初始化的变量含有一个不确定的值，所以使用未初始化变量的值是一种错误的编程行为。

### 2.2.2 变量声明和定义的关系
如果想声明一个变量而非定义它，就在变量名前添加关键字`extern`，且不要显式地初始化。
```c++
extern int i; // 声明i而非定义i
int j;    // 声明并定义j
extern double pi = 3.1415926; // 定义
```

### 2.2.3 标识符
C++的标识符由字母、数字和下划线组成，其中必须以字母或下划线开头。标识符的长度没有限制，但对大小写敏感。

用户自定义的标识符中不能连续出现2个下划线，也不能以下划线紧连大写字母开头。定义在函数体外的标识符不能以下划线开头。

<table>
    <tr><th colspan="5">C++关键字</th></tr>
    <tr>
        <td>alignas</td> <td>continue</td> <td>friend</td> <td>register</td> <td>true</td>
    </tr>
    <tr>
        <td>alignof</td> <td>decltype</td> <td>goto</td> <td>reinterpret_cast</td> <td>try</td>
    </tr>
    <tr>
        <td>asm</td> <td>default</td> <td>if</td> <td>return</td> <td>typedef</td>
    </tr>
    <tr>
        <td>auto</td> <td>delete</td> <td>inline</td> <td>short</td> <td>typeid</td>
    </tr>
    <tr>
        <td>bool</td> <td>do</td> <td>int</td> <td>signed</td> <td>typename</td>
    </tr>
    <tr>
        <td>break</td> <td>double</td> <td>long</td> <td>sizeof</td> <td>union</td>
    </tr>
    <tr>
        <td>case</td> <td>dynamic_cast</td> <td>mutable</td> <td>static</td> <td>unsigned</td>
    </tr>
    <tr>
        <td>catch</td> <td>else</td> <td>namespace</td> <td>static_assert</td> <td>using</td>
    </tr>
    <tr>
        <td>char</td> <td>enum</td> <td>new</td> <td>static_cast</td> <td>virtual</td>
    </tr>
    <tr>
        <td>char16_t</td> <td>explicit</td> <td>noexcept</td> <td>struct</td> <td>void</td>
    </tr>
    <tr>
        <td>char32_t</td> <td>export</td> <td>nullptr</td> <td>switch</td> <td>volatile</td>
    </tr>
    <tr>
        <td>class</td> <td>extern</td> <td>operator</td> <td>template</td> <td>wchar_t</td>
    </tr>
    <tr>
        <td>const</td> <td>false</td> <td>private</td> <td>this</td> <td>while</td>
    </tr>
    <tr>
        <td>constexpr</td> <td>float</td> <td>protected</td> <td>thread_local</td> <td></td>
    </tr>
    <tr>
        <td>const_cast</td> <td>for</td> <td>public</td> <td>throw</td> <td></td>
    </tr>
</table>
<table>
    <tr><th colspan="6">C++操作符替代名</th></tr>
    <tr>
        <td>and</td> <td>bitand</td> <td>compl</td> <td>not_eq</td> <td>or_eq</td> <td>xor_eq</td>
    </tr>
    <tr>
        <td>and_eq</td> <td>bitor</td> <td>not</td> <td>or</td> <td>xor</td> <td></td>
    </tr>
</table>
### 2.2.4 名字的作用域

## 2.3 复合类型
### 2.3.1 引用
C++语言中有7种复合类型：**数组**、**指针**、**引用**、**类**、**枚举**、**函数**和**成员指针**。

引用即别名。这里的引用是指左值引用。

引用本身不是一个对象，一旦定义了引用，就无法令其再绑定另外的对象了，之后每次使用这个引用都是访问它最初绑定的那个对象。

### 2.3.2 指针
指针无须在定义时赋初值。

指针本身是一个对象，可以对指针进行赋值和拷贝，而且指针可以先后指向几个不同的对象。

`void*`是一种特殊的指针类型，它可以指向任何类型的对象。

### 2.3.3 理解复合类型的声明

## 2.4 const限定符
默认状态下， const对象仅在文件内有效。

如果想在多个文件之间共享const对象，必须在变量的定义之前添加extern关键宇。
### 2.4.1 const的引用
### 2.4.2 指针和const
### 2.4.3 顶层const
**顶层const**表示指针本身是一个常量。**底层const**表示指针所指向的对象是一个常量。
### 2.4.4 constexpr和常量表达式
**常量表达式**是指值不会改变并且在编译过程中就能得到计算结果的表达式。

函数体内定义的变量一般来说并非存放在固定地址中；定义在所有函数体之外的对象其地址固定不变，可以用来初始化`constexpr`指针。

## 2.5 处理类型
### 2.5.1 类型别名
1. typedef
```text
typedef double wages; // wages是double的同义词
typedef wages base, *p; // base是double的同义词，p是double*的同义词
typedef char *pString;  // pString是char*的同义词
```
2. using
```text
using SI = Sales_item; // SI是Sales_item的同义词
```

### 2.5.2 auto类型说明符
C++11引入了auto类型说明符，用它可以让编译器替我们分析表达式所属的类型。

auto一般会忽略顶层const，保留底层const。

auto定义的变量必须有初始值。

### 2.5.3 decltype类型提示符
C++11引入了decltype，它的作用是选择并返回操作数的数据类型。编译器会分析表达式并得到它的类型，却不会实际计算表达式的值。

## 2.6 自定义数据结构
### 2.6.1 定义Sales_data类型
### 2.6.2 使用Sales_data类
### 2.6.3 编写自己的头文件
类通常被定义在头文件中，且头文件的名字与类的名字一样。

头文件通常包含那些只能被定义一次的实体，如类、const和constexpr变量等。






## 第2章 练习题
### 2.1.1节练习
<b>练习2.1</b> 类型int、long、long long和short的区别是什么？无符号类型和带符号类型的区别是什么？float和double的区别是什么？

<b>练习2.2</b> 计算按揭贷款时，对于利率、本金和付款分别应选择何种数据类型？说明你的理由。


### 2.1.2节练习
<b>练习2.3</b> 读程序写结果
```c++
unsigned u = 10, u2 = 42;
std::cout << u2 - u << std::endl;
std::cout << u - u2 << std::endl;

int i = 10, i2 = 42;
std::cout << i2 - i << std::endl;
std::cout << i - i2 << std::endl;
std::cout << i - u << std::endl;
std::cout << u - i << std::endl;
```

<b>练习2.4</b> 编写程序检查你的估计是否正确，如果不正确，请仔细研读本节的内容。


### 2.1.3节练习
<b>练习2.5</b> 指出下述字面值的数据类型并说明每一组内几种字面值的区别：
```text
(a) 'a' L'a' "a" L"a"
(b) 10 10u 10L 10uL 012 0xC
(c) 3.14 3.14f 3.14L
(d) 10 10u 10. 10e-2
```

<b>练习2.6</b> 下面2组定义是否有区别？如果有，请找出区别。
```c++
int mouth = 9, day = 7;
int mouth = 09, day = 07;
```

<b>练习2.7</b> 下述字面值表示何种含义？它们各自的数据类型是什么？
```text
(a) "Who goes with F\145rgus?\012"
(b) 3.14elL
(c) 1024f
(d) 3.14L
```

<b>练习2.8</b> 请利用转义序列编写一段程序，要求先输出2M，然后转到新一行。修改程序使其先输出2，然后输出制表符，再输出M，最后转到新一行。


### 2.2.1节练习
<b>练习2.9</b> 解释下列定义的含义。对于非法的定义，请说明错在何处并纠正之。
```text
(a) std::cin >> int input_value;
(b) int i = { 3.14 };
(c) double salary = wage = 9999.99;
(d) int i = 3.14;
```

<b>练习2.10</b> 下列变量的初值分别是什么？
```c++
std::string global_str;
int global_int;

int main() {
    int local_int;
    std::string local_str;
}
```


### 2.2.2节练习
<b>练习2.11</b> 指出下面地语句是声明还是定义：
```text
(a) extern int ix = 1024;
(b) int iy;
(c) extern int iz;
```


### 2.2.3节练习
<b>练习2.12</b> 请指出下面的名字中哪些是非法的？
```text
(a) int double = 3.14;             (b) int _;
(c) int catch-22;                  (d) int 1_or_2 = 1;
(e) double Double = 3.14;
```


### 2.2.4节练习
<b>练习2.13</b> 下面程序中j的值是多少？
```c++
int i = 42;
int main() {
    int i = 100;
    int j = i;
}
```

<b>练习2.14</b> 下面的程序合法吗？如何合法，它将输出什么？
```c++
int i = 100, sum = 0;
for (int i = 0; i != 10; ++i)
    sum += i;
std::cout << i << " " << sum << std::endl;
```


### 2.3.1节练习
<b>练习2.15</b> 下面哪个定义是非法的？为什么？
```text
(a) int iVal = 1.01;      (b) int &rVal1 = 1.01;
(c) int &rVal2 = iVal;    (d) int &rVal3;
```

<b>练习2.16</b> 下面哪些赋值是非法的？为什么？哪些是合法的？它们执行了什么样的操作？
```text
int i = 0, &r1 = i;         double d = 0, &r2 = d;
(a) r2 = 3.14159;           (b) r2 = r1;
(c) i = r2;                 (d) r1 = d;
```

<b>练习2.17</b> 执行下面的代码片段后将输出什么结果？
```c++
int i, &ri = i;
i = 5; ri = 10;
std::cout << i << " " << ri << std::endl;
```


### 2.3.2节练习
<b>练习2.18</b> 编写代码分别更改指针的值以及指针所指对象的值。

<b>练习2.19</b> 说明指针和引用的主要区别。

<b>练习2.20</b> 请叙述下面这段代码的作用。
```c++
int i = 42;
int *p1 = &i;
*p1 = *p1 * *p1;
```

<b>练习2.21</b> 解释下面的定义，如果由非法的，为什么？
```text
int i = 0;
(a) double* dp = &i;    (b) int *ip = i;    (c) int *p = &i;
```

<b>练习2.22</b> 假设p是一个int类型的指针，请说明下述代码的含义。
```text
if(p) // ...
if(*p) // ...
```

<b>练习2.23</b> 给定指针p，你能知道它是否指向了一个合法的对象吗？请说明原因。

<b>练习2.24</b> 在下面的这段代码中，为什么p合法而lp非法？
```text
int i = 50;     void *p = &i;     long *lp = &i;
```


### 2.3.3节练习
<b>练习2.25</b> 说明下列变量的类型和值。
```text
(a) int* ip, i, &r = i;
(b) int i, *ip = 0;
(c) int* ip, ip2;
```


### 2.4节练习
<b>练习2.26</b> 下面哪些句子是合法的？如果由不合法的，请说明原因。
```text
(a) const int buf;          (b) int cnt = 0;
(c) const int sz = cnt;     (d) ++cnt; ++sz;
```


### 2.4.2节练习
<b>练习2.27</b> 下面哪些初始化是合法的？请说明理由。
```text
(a) int i = -1, &r = 0;          (b) int *const p2 = &i2;
(c) const int i = -1, &r = 0;    (d) const int *const p3 = &i2;
(e) const int *p1 = &i2;         (f) const int &const r2;
(g) const int i2 = i, &r = i;
```

<b>练习2.28</b> 下面这些定义是什么意思，请挑出其中不合法的。
```text
(a) int i, *const cp;            (b) int *p1, *const p2;
(c) const int ic, &r = ic;       (d) const int *const p3;
(e) const int *p;
```

<b>练习2.29</b> 假设已有上一个练习中定义的那些变量，则下面哪些语句是合法的？请说明原因。
```text
(a) i = ic;                      (b) p1 = p3;
(c) p1 = &ic;                    (d) p3 = &ic;
(e) p2 = p1;                     (f) ic = *p3;
```


### 2.4.3节练习
<b>练习2.30</b> 对于下面的这些语句，请说明对象被声明成了顶层const还是底层const？
```c++
const int v2 = 0;           int v1 = v2;
int *p1 = &v1, &r1 = v1;
const int *p2 = &v2, *const p3 = &i, &r2 = v2;
```

<b>练习2.31</b> 假设已有上一个练习中所做的那些声明，则下面的哪些语句是合法的？请说明顶层const和底层const在每个例子中是如何体现的。
```c++
r1 = v2;
p1 = p2; p2 = p1;
p1 = p3; p2 = p3;
```


### 2.4.4节练习
<b>练习2.32</b> 下面的代码是否合法？如果非法，请设法将其修正。
```c++
int null = 0, *p = null;
```


### 2.5.2节练习
<b>练习2.33</b> 利用本节定义的变量，判断下列语句的运行结果。
```text
a = 42; b = 42; c = 42;
d = 42; e = 42; g = 42;
```

<b>练习2.34</b> 基于上一个练习中的变量和语句编写一段程序，输出赋值前后变量的内容，判断自己的推断正确吗？如果不对，请反复回看本节内容。

<b>练习2.35</b> 判断下列定义推断出的类型是什么？然后编写程序验证。


### 2.5.3节练习
<b>练习2.36</b> 关于下面的代码，请指出每一个变量的类型以及程序结束时它们各自的值。
```c++
int a = 3, b = 4;
decltype(a) c = a;
decltype((b)) d = a;
++c;
++d;
```

<b>练习2.37</b> 赋值是会产生引用的一类典型表达式，引用的类型就是左值的类型。也就是说，如果i是int，则表达式i=x的类型是int&。根据这一特点，请指出下面的代码中每一个变量的类型和值。
```c++
int a = 3, b = 4;
decltype(a) c = a;
decltype(a = b) d = a;
```

<b>练习2.38</b> 说明由decltype指定类型和由auto指定类型有何区别。请举出一个例子，decltype指定的类型和auto指定的类型一样；
再举一个例子，decltype指定的类型和auto指定的类型不一样。


### 2.6.1节练习
<b>练习2.39</b> 编译下面的程序观察其运行结果，注意，如果忘记写类定义体后面的分号会发生什么情况？记录下相关信息，以后可能会有用。

<b>练习2.40</b> 根据自己的理解写出Sales_data类，最好与书中的例子有所区别。

### 2.6.2节练习
<b>练习2.41</b> 使用自己的Sales_data类重写1.5.1节、1.5.2节和1.6节的练习。眼下先把Sales_data类的定义和main函数放在同一文件里。


### 2.6.1节练习
<b>练习2.42</b> 根据你自己的理解重写一个Sales_data.h头文件，并以此为基础重做2.6.2节的练习。
